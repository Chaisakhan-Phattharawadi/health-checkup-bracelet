<?php
// ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
$servername = "localhost";
$username = "root";
$password = "";
$dbname = "report_db";  // ‡∏ä‡∏∑‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì

$conn = new mysqli($servername, $username, $password, $dbname);

// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
if ($conn->connect_error) {
    die("Connection failed: " . $conn->connect_error);
}

// ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Å‡∏£‡∏≠‡∏Å‡∏õ‡∏±‡∏ç‡∏´‡∏≤
if ($_SERVER['REQUEST_METHOD'] == 'POST' && isset($_POST['problem'])) {
    $problem = $_POST['problem'];
    $sql = "INSERT INTO problems (problem_text) VALUES ('$problem')";
    if ($conn->query($sql) === TRUE) {
        echo "<p class='success-message'>‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß!</p>";
    } else {
        echo "<p class='error-message'>‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: " . $conn->error . "</p>";
    }
}

// ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°
if ($_SERVER['REQUEST_METHOD'] == 'POST' && isset($_POST['answer'])) {
    $answer = $_POST['answer'];
    $problem_id = $_POST['problem_id'];
    $sql = "INSERT INTO answers (problem_id, answer_text) VALUES ('$problem_id', '$answer')";
    if ($conn->query($sql) === TRUE) {
        echo "<p class='success-message'>‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß!</p>";
    } else {
        echo "<p class='error-message'>‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: " . $conn->error . "</p>";
    }
}
?>

<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Report</title>
    <link rel="stylesheet" href="style.css"> <!-- ‡∏•‡∏¥‡∏á‡∏Ñ‡πå‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡πÑ‡∏ü‡∏•‡πå CSS ‡∏†‡∏≤‡∏¢‡∏ô‡∏≠‡∏Å -->
</head>
<body>
    <!-- ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏´‡∏•‡∏±‡∏Å -->
    <h1>‡πÅ‡∏à‡πâ‡∏á‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö</h1>

    <!-- ‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Å‡∏£‡∏≠‡∏Å‡∏õ‡∏±‡∏ç‡∏´‡∏≤ -->
    <form action="report.php" method="POST">
        <label for="problem">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì:</label><br>
        <textarea name="problem" id="problem" rows="4" cols="50" required></textarea><br><br>
        <input type="submit" value="‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏õ‡∏±‡∏ç‡∏´‡∏≤">
    </form>

    <hr>

    <!-- ‡πÅ‡∏™‡∏î‡∏á‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö -->
    <h2>‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö</h2>
    <?php
    // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏à‡∏≤‡∏Å‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
    $sql = "SELECT * FROM problems";
    $result = $conn->query($sql);

    if ($result->num_rows > 0) {
        // ‡πÅ‡∏™‡∏î‡∏á‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡∏•‡∏∞‡∏ï‡∏±‡∏ß
        while($row = $result->fetch_assoc()) {
            echo '<div class="problem-container"><strong>‡∏õ‡∏±‡∏ç‡∏´‡∏≤: </strong>' . $row['problem_text'] . "</div>";

            // ‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°
            echo '<form action="report.php" method="POST">';
            echo '<textarea name="answer" rows="4" cols="50" required></textarea><br>';
            echo '<input type="hidden" name="problem_id" value="' . $row['id'] . '">';
            echo '<input type="submit" value="‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°">';
            echo '</form>';

            // ‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡∏°‡∏µ
            $problem_id = $row['id'];
            $sql_answers = "SELECT * FROM answers WHERE problem_id = '$problem_id'";
            $answers_result = $conn->query($sql_answers);

            if ($answers_result->num_rows > 0) {
                echo '<div class="answer-container">';
                while ($answer_row = $answers_result->fetch_assoc()) {
                    echo "<div><strong>‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö: </strong>" . $answer_row['answer_text'] . "</div>";
                }
                echo '</div>';
            }
            echo "<hr>";
        }
    } else {
        echo "<p>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å!</p>";
    }

    // ‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
    $conn->close();
    ?>

    <!-- ‡πÄ‡∏°‡∏ô‡∏π‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á -->
    <nav class="bottom-nav">
        <a href="index.php" class="nav-item active">
            <i class="icon">üè†</i>
            <span>Home</span>
        </a>
        <a href="health.php" class="nav-item">
            <i class="icon">‚ù§Ô∏è</i>
            <span>Health</span>
        </a>
        <a href="report.php" class="nav-item">
            <i class="icon">üìä</i>
            <span>Reports</span>
        </a>
        <a href="#" class="nav-item">
            <i class="icon">üë§</i>
            <span>Profile</span>
        </a>
    </nav>
</body>
</html>